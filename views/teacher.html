<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - English Learning Center</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/teacher.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-circle">E</div>
                <h1>English Center</h1>
            </div>
            
            <div class="menu">
                <a href="#" class="menu-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="menu-item" data-section="materials">
                    <i class="fas fa-book"></i>
                    <span>Course Materials</span>
                </a>
                <a href="#" class="menu-item" data-section="assignments">
                    <i class="fas fa-tasks"></i>
                    <span>Assignments</span>
                </a>
                <a href="#" class="menu-item" data-section="students">
                    <i class="fas fa-users"></i>
                    <span>Students</span>
                </a>
                <a href="#" class="menu-item" data-section="progress">
                    <i class="fas fa-chart-bar"></i>
                    <span>Progress Reports</span>
                </a>
            </div>
            
            <div class="bottom-menu">
                <a href="login.html" class="menu-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>Teacher Dashboard</h1>
                <div class="user-info">
                    <div class="user-avatar">T</div>
                    <div>
                        <div>Sarah Williams</div>
                        <small>Teacher</small>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <div class="welcome-card">
                    <h2>Welcome back, Sarah!</h2>
                    <p>You have 8 assignments to grade and 2 classes today. Your next class "Conversational English" starts in 45 minutes.</p>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Upload Materials -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Upload Course Materials</h3>
                        </div>
                        <form id="uploadMaterialForm">
                            <div class="form-group">
                                <label for="materialClass">Select Class</label>
                                <select id="materialClass" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="materialTitle">Material Title</label>
                                <input type="text" id="materialTitle" class="form-control" placeholder="Enter title for the material" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="materialType">Material Type</label>
                                <select id="materialType" class="form-control" required>
                                    <option value="">Select type</option>
                                    <option value="slides">Slides</option>
                                    <option value="document">Document</option>
                                    <option value="video">Video Link</option>
                                    <option value="audio">Audio</option>
                                    <option value="exercise">Exercise</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="materialFile">Upload File</label>
                                <div class="file-upload" onclick="document.getElementById('materialFile').click();">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Drag & drop files here or click to browse</p>
                                    <input type="file" id="materialFile" style="display: none;">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="materialDescription">Description</label>
                                <textarea id="materialDescription" class="form-text" placeholder="Add description or instructions"></textarea>
                            </div>

                            <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-block">Upload Material</button>
                            </div>
                        </form>
                    </div>
                
                    <!-- Create Assignment -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Create New Assignment</h3>
                        </div>
                        <form id="createAssignmentForm">
                            <div class="form-group">
                                <label for="assignmentTitle">Assignment Title</label>
                                <input type="text" id="assignmentTitle" class="form-control" placeholder="Enter assignment title" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="assignmentClass">Select Class</label>
                                <select id="assignmentClass" class="form-control" required>
                                    <option value="">Choose a class</option>
                                    <option value="1">Conversational English</option>
                                    <option value="2">Business English</option>
                                    <option value="3">Beginner English</option>
                                    <option value="4">IELTS Preparation</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group half-width">
                                    <label for="assignmentDueDate">Due Date</label>
                                    <input type="date" id="assignmentDueDate" class="form-control" required>
                                </div>
                                
                                <div class="form-group half-width">
                                    <label for="assignmentPoints">Total Points</label>
                                    <input type="number" id="assignmentPoints" class="form-control" placeholder="Enter total points" min="1" max="100" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="assignmentInstructions">Instructions</label>
                                <textarea id="assignmentInstructions" class="form-control" placeholder="Provide detailed instructions for students" rows="4" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="assignmentFile">Attachment (Optional)</label>
                                <div class="file-upload" onclick="document.getElementById('assignmentFile').click();">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Drag & drop files here or click to browse</p>
                                    <input type="file" id="assignmentFile" style="display: none;">
                                </div>
                            </div>
                            
                            <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-block">Create Assignment</button>
                            </div>
                        </form>
                    </div>
                </div>

                
                <div class="card">
                    <div class="card-header">
                        <h3>Write New Progress Report</h3>
                    </div>
                    <form id="writeReportForm">
                        <div class="form-group">
                            <label for="reportType">Report Type</label>
                            <select id="reportType" class="form-control" required>
                                <option value="">Select Report Type</option>
                                <option value="individual">Individual Report</option>
                                <option value="class">Class Report</option>
                            </select>
                        </div>
                
                        <div class="form-group">
                            <label for="selectedClass">Select Class</label>
                            <select id="selectedClass" class="form-control" required>
                                <option value="">Choose a class</option>
                                <option value="conversational">Conversational English</option>
                                <option value="business">Business English</option>
                                <option value="beginner">Beginner English</option>
                                <option value="ielts">IELTS Preparation</option>
                            </select>
                        </div>
                
                        <div class="form-group">
                            <label for="reportTitle">Report Title</label>
                            <input 
                                type="text" 
                                id="reportTitle" 
                                class="form-control" 
                                placeholder="Enter report title" 
                                required
                            >
                        </div>
                
                        <div class="form-group">
                            <label for="reportDescription">Report Description</label>
                            <textarea 
                                id="reportDescription" 
                                class="form-text" 
                                placeholder="Provide detailed report description"
                                rows="4"
                            ></textarea>
                        </div>
                
                        <div class="form-group">
                            <label for="reportFile">Attachment (Optional)</label>
                            <div class="file-upload">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drag & drop files here or click to browse</p>
                                <input 
                                    type="file" 
                                    id="reportFile" 
                                    style="display: none;"
                                >
                            </div>
                        </div>
                
                        <div class="form-actions">
                            <button 
                                type="submit" 
                                class="btn btn-primary btn-block"
                            >
                                Generate Report
                            </button>
                        </div>
                    </form>
                </div>
                
                <script>
                document.getElementById('writeReportForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Collect form data
                    const formData = {
                        reportType: document.getElementById('reportType').value,
                        selectedClass: document.getElementById('selectedClass').value,
                        reportTitle: document.getElementById('reportTitle').value,
                        reportDescription: document.getElementById('reportDescription').value,
                        reportFile: document.getElementById('reportFile').files[0]
                    };
                
                    // You would typically send this data to a server
                    console.log('Report Data:', formData);
                
                    // Optional: Show a success toast or notification
                    alert('Report generated successfully!');
                });
                
                // File upload browse trigger
                document.querySelector('.file-upload').addEventListener('click', function() {
                    document.getElementById('reportFile').click();
                });
                </script>
            </section>
            
            <!-- Materials Section -->
            <section id="materials-section" class="content-section">
                <div class="header-with-actions">
                    <h2 class="section-title">Course Materials</h2>
                </div>
                
                <div class="card">
                    <div class="filter-bar">
                        <select class="form-control filter-select">
                            <option value="">All Classes</option>
                            <option value="conversational">Conversational English</option>
                            <option value="business">Business English</option>
                            <option value="beginner">Beginner English</option>
                            <option value="ielts">IELTS Preparation</option>
                        </select>
                        <select class="form-control filter-select">
                            <option value="">All Types</option>
                            <option value="slides">Slides</option>
                            <option value="document">Documents</option>
                            <option value="video">Videos</option>
                            <option value="audio">Audio</option>
                            <option value="exercise">Exercises</option>
                        </select>
                        <div class="search-bar">
                            <input type="text" class="form-control" placeholder="Search materials...">
                            <button><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                    
                    <div class="materials-list">
                        <div class="material-item">
                            <div class="material-icon">
                                <i class="fas fa-file-powerpoint"></i>
                            </div>
                            <div class="material-info">
                                <div class="material-title">Speaking Practice Slides</div>
                                <div class="material-details">
                                    <div><i class="fas fa-book"></i> Conversational English</div>
                                    <div><i class="fas fa-calendar"></i> Apr 15, 2025</div>
                                    <div><i class="fas fa-user"></i> Uploaded by you</div>
                                </div>
                            </div>
                            <div class="material-actions">
                                <button class="btn btn-secondary"><i class="fas fa-eye"></i> Preview</button>
                                <button class="btn btn-danger"><i class="fas fa-trash"></i> Delete</button>
                            </div>
                        </div>
                        
                        <div class="material-item">
                            <div class="material-icon">
                                <i class="fas fa-file-word"></i>
                            </div>
                            <div class="material-info">
                                <div class="material-title">Business Writing Guidelines</div>
                                <div class="material-details">
                                    <div><i class="fas fa-book"></i> Business English</div>
                                    <div><i class="fas fa-calendar"></i> Apr 12, 2025</div>
                                    <div><i class="fas fa-user"></i> Uploaded by you</div>
                                </div>
                            </div>
                            <div class="material-actions">
                                <button class="btn btn-secondary"><i class="fas fa-eye"></i> Preview</button>
                                <button class="btn btn-danger"><i class="fas fa-trash"></i> Delete</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Empty state will be shown when no results -->
                    <div class="empty-state" style="display: none;">
                        <i class="fas fa-file-alt"></i>
                        <h3>No materials found</h3>
                        <p>There are no materials matching your search criteria.</p>
                    </div>
                </div>
            </section>
            
            <!-- Assignments Section -->
            <section id="assignments-section" class="content-section">
                <div class="header-with-actions">
                    <h2 class="section-title">Assignments</h2>
                </div>
                
                <div class="card">
                    <div class="filter-bar">
                        <select class="form-control filter-select">
                            <option value="">All Classes</option>
                            <option value="conversational">Conversational English</option>
                            <option value="business">Business English</option>
                            <option value="beginner">Beginner English</option>
                            <option value="ielts">IELTS Preparation</option>
                        </select>
                        <select class="form-control filter-select">
                            <option value="">All Statuses</option>
                            <option value="active">Active</option>
                            <option value="upcoming">Upcoming</option>
                            <option value="closed">Closed</option>
                        </select>
                        <div class="search-bar">
                            <input type="text" class="form-control" placeholder="Search assignments...">
                            <button><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                    
                    <div class="assignments-list">
                        <div class="assignment-item">
                            <div class="assignment-header">
                                <div class="assignment-title">Writing Essay</div>
                                <span class="badge badge-success">Active</span>
                            </div>
                            <div class="assignment-details">
                                <div><i class="fas fa-book"></i> Conversational English</div>
                                <div><i class="fas fa-calendar"></i> Due: Apr 18, 2025</div>
                                <div><i class="fas fa-file-alt"></i> 12/15 submitted</div>
                            </div>
                            <div class="assignment-actions">
                                <button class="btn btn-primary"><i class="fas fa-check-square"></i> Grade</button>
                                <button class="btn btn-secondary"><i class="fas fa-edit"></i> Edit</button>
                                <button class="btn btn-danger"><i class="fas fa-trash"></i> Delete</button>
                            </div>
                        </div>
                        
                        <div class="assignment-item">
                            <div class="assignment-header">
                                <div class="assignment-title">Grammar Quiz</div>
                                <span class="badge badge-success">Active</span>
                            </div>
                            <div class="assignment-details">
                                <div><i class="fas fa-book"></i> Beginner English</div>
                                <div><i class="fas fa-calendar"></i> Due: Apr 20, 2025</div>
                                <div><i class="fas fa-file-alt"></i> 15/18 submitted</div>
                            </div>
                            <div class="assignment-actions">
                                <button class="btn btn-primary"><i class="fas fa-check-square"></i> Grade</button>
                                <button class="btn btn-secondary"><i class="fas fa-edit"></i> Edit</button>
                                <button class="btn btn-danger"><i class="fas fa-trash"></i> Delete</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Empty state will be shown when no results -->
                    <div class="empty-state" style="display: none;">
                        <i class="fas fa-tasks"></i>
                        <h3>No assignments found</h3>
                        <p>There are no assignments created yet.</p>
                    </div>
                </div>
            </section>
            
            <!-- Students Section -->
            <section id="students-section" class="content-section">
                <div class="header-with-actions">
                    <h2 class="section-title">Students</h2>
                </div>
                
                <div class="card">
                    <div class="filter-bar">
                        <select class="form-control filter-select">
                            <option value="">All Classes</option>
                            <option value="conversational">Conversational English</option>
                            <option value="business">Business English</option>
                            <option value="beginner">Beginner English</option>
                            <option value="ielts">IELTS Preparation</option>
                        </select>
                        <div class="search-bar">
                            <input type="text" class="form-control" placeholder="Search students...">
                            <button><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                    
                    <div class="students-list">
                        <div class="student-item">
                            <div class="student-info">
                                <div class="student-name">John Smith</div>
                                <div class="student-details">
                                    <div><i class="fas fa-book"></i> Classes: Conversational English</div>
                                    <div><i class="fas fa-chart-line"></i> Average Grade: 85%</div>
                                    <div><i class="fas fa-clock"></i> Attendance: 92%</div>
                                </div>
                            </div>
                            <div class="student-actions">
                                <button class="btn btn-primary">View Profile</button>
                                <button class="btn btn-secondary">Contact</button>
                            </div>
                        </div>
                        
                        <div class="student-item">
                            <div class="student-info">
                                <div class="student-name">Emily Johnson</div>
                                <div class="student-details">
                                    <div><i class="fas fa-book"></i> Classes: Conversational English, Business English</div>
                                    <div><i class="fas fa-chart-line"></i> Average Grade: 92%</div>
                                    <div><i class="fas fa-clock"></i> Attendance: 88%</div>
                                </div>
                            </div>
                            <div class="student-actions">
                                <button class="btn btn-primary">View Profile</button>
                                <button class="btn btn-secondary">Contact</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Empty state will be shown when no results -->
                    <div class="empty-state" style="display: none;">
                        <i class="fas fa-users"></i>
                        <h3>No students found</h3>
                        <p>There are no students matching your search criteria.</p>
                    </div>
                </div>
            </section>
            
            <!-- Progress Reports Section -->
            <section id="progress-section" class="content-section">
                <div class="header-with-actions">
                    <h2 class="section-title">Progress Reports</h2>
                </div>
                
                <div class="card">
                    <div class="filter-bar">
                        <select class="form-control filter-select">
                            <option value="">All Classes</option>
                            <option value="conversational">Conversational English</option>
                            <option value="business">Business English</option>
                            <option value="beginner">Beginner English</option>
                            <option value="ielts">IELTS Preparation</option>
                        </select>
                        <select class="form-control filter-select">
                            <option value="individual">Individual Reports</option>
                            <option value="class">Class Reports</option>
                        </select>
                    </div>
                    
                    <div class="reports-list">
                        <div class="report-item">
                            <div class="report-info">
                                <div class="report-title"> Conversational English - Mid-term Progress</div>
                                <div class="report-details">
                                    <div><i class="fas fa-calendar"></i> Generated: Apr 15, 2025</div>
                                    <div><i class="fas fa-users"></i> 15 students</div>
                                </div>
                            </div>
                            <div class="report-actions">
                                <button class="btn btn-primary">View Report</button>
                                <button class="btn btn-secondary">Download PDF</button>
                            </div>
                        </div>
                        
                        <div class="report-item">
                            <div class="report-info">
                                <div class="report-title">Business English - Weekly Assessment</div>
                                <div class="report-details">
                                    <div><i class="fas fa-calendar"></i> Generated: Apr 12, 2025</div>
                                    <div><i class="fas fa-users"></i> 12 students</div>
                                </div>
                            </div>
                            <div class="report-actions">
                                <button class="btn btn-primary">View Report</button>
                                <button class="btn btn-secondary">Download PDF</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Empty state will be shown when no results -->
                    <div class="empty-state" style="display: none;">
                        <i class="fas fa-chart-line"></i>
                        <h3>No reports available</h3>
                        <p>There are no progress reports available yet.</p>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <script src="js/components/common.js"></script>
    <script src="js/pages/teacher.js"></script>
    <script>
        // Improved teacher dashboard script with fixed button handling
        document.addEventListener('DOMContentLoaded', function() {
            // First fix tab navigation
            setupTabNavigation();
            // Remove any existing event listeners from buttons by replacing them
            replaceAllButtons();
            setupMaterialsFiltering();
            setupStudentsFiltering();
            setupProgressReportsFiltering();
            setupAssignmentsFiltering();
            // Then add our event listeners to the clean buttons
            addButtonListeners();
            // Add required CSS styles for modals
            addModalStyles();
        });

// ===== MATERIALS SECTION FILTERING =====
function setupMaterialsFiltering() {
    // Get the filter elements
    const classFilter = document.querySelector('#materials-section select:first-child, .filter-bar select:first-child');
    const typeFilter = document.querySelector('#materials-section select:nth-child(2), .filter-bar select:nth-child(2)');
    const searchInput = document.querySelector('#materials-section .search-bar input');
    const searchButton = document.querySelector('#materials-section .search-bar button');
    
    // Populate class filter with the 4 default classes
    if (classFilter) {
        // Start with the "All Classes" option
        classFilter.innerHTML = '<option value="">All Classes</option>';
        
        // Add the 4 default classes
        const defaultClasses = [
            { value: 'conversational', text: 'Conversational English' },
            { value: 'business', text: 'Business English' },
            { value: 'beginner', text: 'Beginner English' },
            { value: 'ielts', text: 'IELTS Preparation' }
        ];
        
        defaultClasses.forEach(cls => {
            const option = document.createElement('option');
            option.value = cls.value;
            option.textContent = cls.text;
            classFilter.appendChild(option);
        });
    }
    
    // Populate type filter with material types
    if (typeFilter) {
        typeFilter.innerHTML = '<option value="">All Types</option>';
        
        const materialTypes = [
            { value: 'slides', text: 'Slides' },
            { value: 'document', text: 'Documents' },
            { value: 'video', text: 'Videos' },
            { value: 'audio', text: 'Audio' },
            { value: 'exercise', text: 'Exercises' },
            { value: 'other', text: 'Other' }
        ];
        
        materialTypes.forEach(type => {
            const option = document.createElement('option');
            option.value = type.value;
            option.textContent = type.text;
            typeFilter.appendChild(option);
        });
    }
    
    // Add filter function
    function filterMaterials() {
        const classValue = classFilter ? classFilter.value.toLowerCase() : '';
        const typeValue = typeFilter ? typeFilter.value.toLowerCase() : '';
        const searchValue = searchInput ? searchInput.value.toLowerCase().trim() : '';
        
        // Get all material items
        const materialItems = document.querySelectorAll('.material-item');
        let visibleCount = 0;
        
        // If no materials, show empty state
        if (materialItems.length === 0) {
            showMaterialsEmptyState(true);
            return;
        }
        
        materialItems.forEach(item => {
            // Get material details (adjust selectors if needed)
            const materialClass = item.querySelector('.material-details div:first-child')?.textContent.toLowerCase() || '';
            const materialTitle = item.querySelector('.material-title')?.textContent.toLowerCase() || '';
            
            // Determine type from icon
            const materialIcon = item.querySelector('.material-icon i');
            let materialType = 'other';
            
            if (materialIcon) {
                if (materialIcon.classList.contains('fa-file-powerpoint')) materialType = 'slides';
                else if (materialIcon.classList.contains('fa-file-word')) materialType = 'document';
                else if (materialIcon.classList.contains('fa-file-video')) materialType = 'video';
                else if (materialIcon.classList.contains('fa-file-audio')) materialType = 'audio';
                else if (materialIcon.classList.contains('fa-file-alt')) materialType = 'exercise';
            }
            
            // Check if material matches filters
            const matchesClass = !classValue || materialClass.includes(classValue);
            const matchesType = !typeValue || materialType === typeValue;
            const matchesSearch = !searchValue || materialTitle.includes(searchValue);
            
            // Show or hide based on filters
            if (matchesClass && matchesType && matchesSearch) {
                item.style.display = '';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });
        
        // Show empty state if no results
        showMaterialsEmptyState(visibleCount === 0);
    }
    
    // Show empty state when no materials match
    function showMaterialsEmptyState(show) {
        let emptyState = document.querySelector('#materials-section .empty-state');
        
        // Create empty state if it doesn't exist
        if (!emptyState) {
            emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            emptyState.innerHTML = `
                <i class="fas fa-file-alt"></i>
                <h3>No materials found</h3>
                <p>There are no materials matching your search criteria.</p>
                <button class="btn btn-primary"><i class="fas fa-plus"></i> Upload New Material</button>
            `;
            
            // Insert after materials list
            const materialsContainer = document.querySelector('.materials-list');
            if (materialsContainer) {
                materialsContainer.parentNode.insertBefore(emptyState, materialsContainer.nextSibling);
            } else {
                // Or append to section
                const section = document.querySelector('#materials-section');
                if (section) section.appendChild(emptyState);
            }
            
            // Add click event to upload button
            const uploadButton = emptyState.querySelector('button');
            if (uploadButton) {
                uploadButton.addEventListener('click', function() {
                    // Scroll to upload form
                    const uploadForm = document.getElementById('uploadMaterialForm');
                    if (uploadForm) uploadForm.scrollIntoView({ behavior: 'smooth' });
                });
            }
        }
        
        // Show or hide empty state
        emptyState.style.display = show ? 'block' : 'none';
    }
    
    // Add event listeners
    if (classFilter) classFilter.addEventListener('change', filterMaterials);
    if (typeFilter) typeFilter.addEventListener('change', filterMaterials);
    
    if (searchInput) {
        searchInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') filterMaterials();
        });
    }
    
    if (searchButton) searchButton.addEventListener('click', filterMaterials);
    
    // Initial filtering
    filterMaterials();
}

// ===== STUDENTS SECTION FILTERING =====
function setupStudentsFiltering() {
    // Get filter elements
    const classFilter = document.querySelector('#students-section select, .filter-bar select');
    const searchInput = document.querySelector('#students-section .search-bar input');
    const searchButton = document.querySelector('#students-section .search-bar button');
    
    // Populate class filter with the 4 default classes
    if (classFilter) {
        // Start with "All Classes" option
        classFilter.innerHTML = '<option value="">All Classes</option>';
        
        // Add default classes
        const defaultClasses = [
            { value: 'conversational', text: 'Conversational English' },
            { value: 'business', text: 'Business English' },
            { value: 'beginner', text: 'Beginner English' },
            { value: 'ielts', text: 'IELTS Preparation' }
        ];
        
        defaultClasses.forEach(cls => {
            const option = document.createElement('option');
            option.value = cls.value;
            option.textContent = cls.text;
            classFilter.appendChild(option);
        });
    }
    
    // Filter students function
    function filterStudents() {
        const classValue = classFilter ? classFilter.value.toLowerCase() : '';
        const searchValue = searchInput ? searchInput.value.toLowerCase().trim() : '';
        
        // Get all student items
        const studentItems = document.querySelectorAll('.student-item');
        let visibleCount = 0;
        
        // If no students, show empty state
        if (studentItems.length === 0) {
            showStudentsEmptyState(true);
            return;
        }
        
        studentItems.forEach(item => {
            // Get student details
            const studentClasses = item.querySelector('.student-details div:first-child')?.textContent.toLowerCase() || '';
            const studentName = item.querySelector('.student-name')?.textContent.toLowerCase() || '';
            
            // Check if student matches filters
            const matchesClass = !classValue || studentClasses.includes(classValue);
            const matchesSearch = !searchValue || studentName.includes(searchValue);
            
            // Show or hide based on filters
            if (matchesClass && matchesSearch) {
                item.style.display = '';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });
        
        // Show empty state if no results
        showStudentsEmptyState(visibleCount === 0);
    }
    
    // Show empty state when no students match
    function showStudentsEmptyState(show) {
        let emptyState = document.querySelector('#students-section .empty-state');
        
        // Create empty state if it doesn't exist
        if (!emptyState) {
            emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            emptyState.innerHTML = `
                <i class="fas fa-users"></i>
                <h3>No students found</h3>
                <p>There are no students matching your search criteria.</p>
            `;
            
            // Insert after students list
            const studentsContainer = document.querySelector('.students-list');
            if (studentsContainer) {
                studentsContainer.parentNode.insertBefore(emptyState, studentsContainer.nextSibling);
            } else {
                // Or append to section
                const section = document.querySelector('#students-section');
                if (section) section.appendChild(emptyState);
            }
        }
        
        // Show or hide empty state
        emptyState.style.display = show ? 'block' : 'none';
    }
    
    // Add event listeners
    if (classFilter) classFilter.addEventListener('change', filterStudents);
    
    if (searchInput) {
        searchInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') filterStudents();
        });
    }
    
    if (searchButton) searchButton.addEventListener('click', filterStudents);
    
    // Initial filtering
    filterStudents();
}

// ===== PROGRESS REPORTS SECTION FILTERING =====
function setupProgressReportsFiltering() {
    // Get filter elements
    const classFilter = document.querySelector('#progress-section select:first-child, .filter-bar select:first-child');
    const typeFilter = document.querySelector('#progress-section select:nth-child(2), .filter-bar select:nth-child(2)');
    
    // Populate class filter with the 4 default classes
    if (classFilter) {
        // Start with "All Classes" option
        classFilter.innerHTML = '<option value="">All Classes</option>';
        
        // Add default classes
        const defaultClasses = [
            { value: 'conversational', text: 'Conversational English' },
            { value: 'business', text: 'Business English' },
            { value: 'beginner', text: 'Beginner English' },
            { value: 'ielts', text: 'IELTS Preparation' }
        ];
        
        defaultClasses.forEach(cls => {
            const option = document.createElement('option');
            option.value = cls.value;
            option.textContent = cls.text;
            classFilter.appendChild(option);
        });
    }
    
    // Ensure type filter has options
    if (typeFilter && typeFilter.options.length === 0) {
        typeFilter.innerHTML = `
            <option value="individual">Individual Reports</option>
            <option value="class">Class Reports</option>
        `;
    }
    
    // Filter reports function
    function filterReports() {
        const classValue = classFilter ? classFilter.value.toLowerCase() : '';
        const typeValue = typeFilter ? typeFilter.value.toLowerCase() : '';
        
        // Get all report items
        const reportItems = document.querySelectorAll('.report-item');
        let visibleCount = 0;
        
        // If no reports, show empty state
        if (reportItems.length === 0) {
            showReportsEmptyState(true);
            return;
        }
        
        reportItems.forEach(item => {
            // Get report details
            const reportTitle = item.querySelector('.report-title')?.textContent.toLowerCase() || '';
            
            // Determine report type (class or individual)
            const isClassReport = reportTitle.includes('class');
            const reportType = isClassReport ? 'class' : 'individual';
            
            // Check if report matches filters
            const matchesClass = !classValue || reportTitle.includes(classValue);
            const matchesType = !typeValue || reportType === typeValue;
            
            // Show or hide based on filters
            if (matchesClass && matchesType) {
                item.style.display = '';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });
        
        // Show empty state if no results
        showReportsEmptyState(visibleCount === 0);
    }
    
    // Show empty state when no reports match
    function showReportsEmptyState(show) {
        let emptyState = document.querySelector('#progress-section .empty-state');
        
        // Create empty state if it doesn't exist
        if (!emptyState) {
            emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            emptyState.innerHTML = `
                <i class="fas fa-chart-line"></i>
                <h3>No reports available</h3>
                <p>There are no progress reports matching your search criteria.</p>
            `;
            
            // Insert after reports list
            const reportsContainer = document.querySelector('.reports-list');
            if (reportsContainer) {
                reportsContainer.parentNode.insertBefore(emptyState, reportsContainer.nextSibling);
            } else {
                // Or append to section
                const section = document.querySelector('#progress-section');
                if (section) section.appendChild(emptyState);
            }
        }
        
        // Show or hide empty state
        emptyState.style.display = show ? 'block' : 'none';
    }
    
    // Add event listeners
    if (classFilter) classFilter.addEventListener('change', filterReports);
    if (typeFilter) typeFilter.addEventListener('change', filterReports);
    
    // Initial filtering
    filterReports();
}
    
    // Helper function to determine material type based on icon or class
    function determineType(materialItem) {
        // This needs to be customized based on your HTML structure
        const iconElement = materialItem.querySelector('.material-icon i');
        if (!iconElement) return '';
        
        const iconClass = iconElement.className;
        
        if (iconClass.includes('fa-file-powerpoint')) return 'slides';
        if (iconClass.includes('fa-file-word')) return 'document';
        if (iconClass.includes('fa-file-video')) return 'video';
        if (iconClass.includes('fa-file-audio')) return 'audio';
        if (iconClass.includes('fa-file-image')) return 'image';
        if (iconClass.includes('fa-link')) return 'link';
        if (iconClass.includes('fa-file-alt')) return 'exercise';
        
        return 'other';
    }
    
    // Add event listeners to filters and search
    classFilter.addEventListener('change', filterMaterials);
    typeFilter.addEventListener('change', filterMaterials);
    
    // Handle search on enter key or button click
    searchInput.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            filterMaterials();
        }
    });
    
    if (searchButton) {
        searchButton.addEventListener('click', filterMaterials);
    }
    
    // Initialize filtering
    fillFilterOptions();

// Function to populate filter dropdowns based on available materials
function fillFilterOptions() {
    // Get filter elements
    const classFilter = document.querySelector('#materials-section select:nth-child(1), .filter-bar select:nth-child(1)');
    const typeFilter = document.querySelector('#materials-section select:nth-child(2), .filter-bar select:nth-child(2)');
    
    if (!classFilter || !typeFilter) return;
    
    // Get all material items
    const materialItems = document.querySelectorAll('.material-item');
    
    // Extract unique classes and types
    const classes = new Set();
    const types = new Set();
    
    materialItems.forEach(item => {
        // Get class
        const classText = item.querySelector('.material-details div:first-child')?.textContent.trim() || '';
        if (classText && classText.includes(':')) {
            const className = classText.split(':')[1].trim();
            classes.add(className);
        }
        
        // Get type
        const type = determineType(item);
        if (type) {
            types.add(type);
        }
    });
    
    // Helper to determine type based on icon
    function determineType(materialItem) {
        const iconElement = materialItem.querySelector('.material-icon i');
        if (!iconElement) return '';
        
        const iconClass = iconElement.className;
        
        if (iconClass.includes('fa-file-powerpoint')) return 'slides';
        if (iconClass.includes('fa-file-word')) return 'document';
        if (iconClass.includes('fa-file-video')) return 'video';
        if (iconClass.includes('fa-file-audio')) return 'audio';
        if (iconClass.includes('fa-file-image')) return 'image';
        if (iconClass.includes('fa-link')) return 'link';
        if (iconClass.includes('fa-file-alt')) return 'exercise';
        
        return 'other';
    }
    
    // Populate class filter
    classFilter.innerHTML = '<option value="">All Classes</option>';
    classes.forEach(className => {
        const option = document.createElement('option');
        option.value = className.toLowerCase();
        option.textContent = className;
        classFilter.appendChild(option);
    });
    
    // Populate type filter
    typeFilter.innerHTML = '<option value="">All Types</option>';
    types.forEach(type => {
        const option = document.createElement('option');
        option.value = type.toLowerCase();
        option.textContent = capitalizeFirstLetter(type);
        typeFilter.appendChild(option);
    });
    
    // Helper function to capitalize first letter
    function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }
}

// For example:

function setupAssignmentsFiltering() {
    // Get filter elements
    const classFilter = document.querySelector('#assignments-section select:nth-child(1)');
    const statusFilter = document.querySelector('#assignments-section select:nth-child(2)');
    const searchInput = document.querySelector('#assignments-section input[type="text"]');
    const searchButton = document.querySelector('#assignments-section .search-bar button');
    
    // Get the assignments list container
    const assignmentsContainer = document.querySelector('.assignments-list');
    
    // If any elements are missing, exit function
    if (!classFilter || !statusFilter || !searchInput || !assignmentsContainer) {
        console.error('Could not find filtering elements or assignments container');
        return;
    }
    
    // Function to filter assignments
    function filterAssignments() {
        const classValue = classFilter.value.toLowerCase();
        const statusValue = statusFilter.value.toLowerCase();
        const searchValue = searchInput.value.toLowerCase().trim();
        
        // Get all assignment items
        const assignmentItems = document.querySelectorAll('.assignment-item');
        let visibleCount = 0;
        
        assignmentItems.forEach(item => {
            // Get the assignment's class
            const assignmentClass = item.querySelector('.assignment-details div:first-child')?.textContent.toLowerCase() || '';
            
            // Get the assignment's status
            const assignmentStatus = item.querySelector('.badge')?.textContent.toLowerCase() || '';
            
            // Get the assignment's title
            const assignmentTitle = item.querySelector('.assignment-title')?.textContent.toLowerCase() || '';
            
            // Check if the assignment matches all filters
            const matchesClass = classValue === '' || assignmentClass.includes(classValue);
            const matchesStatus = statusValue === '' || assignmentStatus.includes(statusValue);
            const matchesSearch = searchValue === '' || assignmentTitle.includes(searchValue);
            
            // Show or hide based on filter matches
            if (matchesClass && matchesStatus && matchesSearch) {
                item.style.display = 'block';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });
        
        // Toggle empty state message
        const emptyState = document.querySelector('#assignments-section .empty-state');
        if (emptyState) {
            emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
        }
    }
    
    // Add event listeners
    classFilter.addEventListener('change', filterAssignments);
    statusFilter.addEventListener('change', filterAssignments);
    
    searchInput.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            filterAssignments();
        }
    });
    
    if (searchButton) {
        searchButton.addEventListener('click', filterAssignments);
    }
}

javascriptdocument.addEventListener('DOMContentLoaded', function() {
    // Your existing setup code
    setupTabNavigation();
    setupButtons();
    addModalStyles();
    
    // Add filtering setup
    setupMaterialsFiltering();
    setupAssignmentsFiltering();
    // Add more sections as needed
});

// Replace all buttons with clones to remove any existing event listeners
function replaceAllButtons() {
    const allButtons = document.querySelectorAll('button');
    allButtons.forEach(button => {
        const clone = button.cloneNode(true);
        button.parentNode.replaceChild(clone, button);
    });
}

// Add event listeners specifically for each button type
function addButtonListeners() {
    // Add event listeners for Grade buttons
    document.querySelectorAll('button.grade-btn, button.btn-primary').forEach(button => {
        // Skip non-grade buttons
        if (!button.classList.contains('grade-btn') && 
            !button.textContent.trim().includes('Grade') && 
            !button.innerHTML.includes('fa-check-square')) {
            return;
        }
        
        // Get or create assignment ID
        let assignmentId = getAssignmentId(button);
        
        // Set data-id attribute
        button.setAttribute('data-id', assignmentId);
        button.setAttribute('data-button-type', 'grade');
        
        // Add click event
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Grade button clicked for assignment:', assignmentId);
            showGradeModal(assignmentId);
        });
    });
    
    // Add event listeners for Edit buttons
    document.querySelectorAll('button.edit-btn, button.btn-secondary').forEach(button => {
        // Skip non-edit buttons
        if (!button.classList.contains('edit-btn') && 
            !button.textContent.trim().includes('Edit') && 
            !button.innerHTML.includes('fa-edit')) {
            return;
        }
        
        // Get or create assignment ID
        let assignmentId = getAssignmentId(button);
        
        // Set data-id attribute
        button.setAttribute('data-id', assignmentId);
        button.setAttribute('data-button-type', 'edit');
        
        // Add click event
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Edit button clicked for assignment:', assignmentId);
            showEditModal(assignmentId);
        });
    });
    
    // Add event listeners for Delete buttons
    document.querySelectorAll('button.delete-btn, button.btn-danger').forEach(button => {
        // Skip non-delete buttons
        if (!button.classList.contains('delete-btn') && 
            !button.textContent.trim().includes('Delete') && 
            !button.innerHTML.includes('fa-trash')) {
            return;
        }
        
        // Get or create assignment ID
        let assignmentId = getAssignmentId(button);
        
        // Set data-id attribute
        button.setAttribute('data-id', assignmentId);
        button.setAttribute('data-button-type', 'delete');
        
        // Add click event
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Delete button clicked for assignment:', assignmentId);
            if (confirm('Are you sure you want to delete?')) {
                handleDeleteAssignment(assignmentId);
            }
        });
    });
}

// Helper function to get or create assignment ID
// Helper function to get or create assignment ID
function getAssignmentId(button) {
    // First try to get it from data-id attribute
    if (button.hasAttribute('data-id')) {
        return button.getAttribute('data-id');
    }
    
    // Then try to extract it from onclick attribute
    if (button.hasAttribute('onclick')) {
        const onclickValue = button.getAttribute('onclick');
        const matches = onclickValue.match(/['"]([^'"]+)['"]/);
        if (matches) {
            button.removeAttribute('onclick'); // Remove onclick to prevent it firing alongside our event
            return matches[1];
        }
    }
    
    // Try to find an ID from a nearby button in the same container
    const container = button.closest('.assignment-item, tr, div');
    if (container) {
        const otherButtons = container.querySelectorAll('button[data-id]');
        for (let otherButton of otherButtons) {
            if (otherButton !== button && otherButton.hasAttribute('data-id')) {
                return otherButton.getAttribute('data-id');
            }
        }
    }
    
    // If all else fails, create a new ID
    return 'assignment-' + Math.floor(Math.random() * 10000);
}

// Set up tab navigation
function setupTabNavigation() {
    // Hide all content sections except dashboard initially
    const sections = document.querySelectorAll('.content-section');
    sections.forEach(section => {
        if (section.id === 'dashboard-section') {
            section.style.display = 'block';
        } else {
            section.style.display = 'none';
        }
    });
    
    // Set up menu item click events
    const menuItems = document.querySelectorAll('.menu-item[data-section]');
    menuItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetSection = this.getAttribute('data-section');
            
            // Update active menu item
            menuItems.forEach(mi => mi.classList.remove('active'));
            this.classList.add('active');
            
            // Show only the target section, hide others
            sections.forEach(section => {
                if (section.id === `${targetSection}-section`) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        });
    });
}

// Add CSS styles for modals
function addModalStyles() {
    // Remove existing styles if they exist
    const existingStyles = document.getElementById('modal-styles');
    if (existingStyles) {
        existingStyles.remove();
    }
    
    const styleElement = document.createElement('style');
    styleElement.id = 'modal-styles';
    styleElement.textContent = `
    /* Modal styles */
    .modal {
        display: block;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
    }
    
    .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 0;
        width: 80%;
        max-width: 800px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .modal-header {
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-header h2 {
        margin: 0;
        font-size: 20px;
    }
    
    .close-modal, .close {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    
    .close-modal:hover, .close:hover {
        color: #333;
    }
    
    .modal-body {
        padding: 20px;
        max-height: 70vh;
        overflow-y: auto;
    }
    
    .modal-footer {
        padding: 15px 20px;
        border-top: 1px solid #eee;
        text-align: right;
    }
    
    .submission-card {
        border: 1px solid #eee;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 20px;
    }
    
    .submission-header {
        background-color: #f9fafc;
        padding: 15px;
        border-bottom: 1px solid #eee;
    }
    
    .submission-content {
        padding: 15px;
    }
    
    .grading-form {
        background-color: #f9fafc;
        padding: 15px;
        border-top: 1px solid #eee;
    }
    
    .form-row {
        display: flex;
        gap: 15px;
    }
    
    .form-group.half-width {
        flex: 1;
    }
    `;
    document.head.appendChild(styleElement);
}

// Clear all existing modals from the page
function clearExistingModals() {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => modal.remove());
}

// Show grade modal
function showGradeModal(assignmentId) {
    try {
        console.log('Creating grade modal for assignment:', assignmentId);
        
        // Clear any existing modals
        clearExistingModals();
        
        // Demo data - in a real app, you would fetch this from your API
        const assignmentData = {
            id: assignmentId,
            title: 'Assignment ' + assignmentId,
            dueDate: new Date().toISOString(),
            totalPoints: 100,
            className: 'English Class',
            totalStudents: 20,
            submissions: [
                {
                    studentId: 'student1',
                    studentName: 'John Smith',
                    submittedAt: new Date().toISOString(),
                    content: 'This is my submission for the assignment.',
                    fileName: 'assignment.pdf',
                    fileUrl: '#',
                    grade: null,
                    feedback: ''
                },
                {
                    studentId: 'student2',
                    studentName: 'Jane Doe',
                    submittedAt: new Date(Date.now() - 86400000).toISOString(),
                    content: 'Here is my completed work.',
                    fileName: 'homework.docx',
                    fileUrl: '#',
                    grade: 85,
                    feedback: 'Good work, but could use more detail.'
                }
            ]
        };
        
        // Create modal HTML (using simpler approach without element creation)
        const modalHTML = `
            <div id="grade-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Grade: ${assignmentData.title}</h2>
                        <span class="close">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="assignment-info" style="margin-bottom: 20px; padding: 15px; background-color: #f9fafc; border-radius: 8px;">
                            <p><strong>Class:</strong> ${assignmentData.className}</p>
                            <p><strong>Due Date:</strong> ${new Date(assignmentData.dueDate).toLocaleDateString()}</p>
                            <p><strong>Submissions:</strong> ${assignmentData.submissions.length}/${assignmentData.totalStudents}</p>
                        </div>
                        
                        <h3>Student Submissions</h3>
                        <div class="submissions-list">
                            ${assignmentData.submissions.map(submission => `
                                <div class="submission-card">
                                    <div class="submission-header">
                                        <h4 style="margin: 0;">${submission.studentName}</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 14px; color: #666;">
                                            Submitted: ${new Date(submission.submittedAt).toLocaleString()}
                                        </p>
                                    </div>
                                    
                                    <div class="submission-content">
                                        ${submission.fileUrl ? 
                                            `<p><a href="${submission.fileUrl}"><i class="fas fa-file"></i> ${submission.fileName}</a></p>` : ''}
                                        <p>${submission.content}</p>
                                    </div>
                                    
                                    <div class="grading-form">
                                        <div class="form-group">
                                            <label for="grade-${submission.studentId}">Grade (out of ${assignmentData.totalPoints})</label>
                                            <input type="number" id="grade-${submission.studentId}" 
                                                class="form-control" min="0" max="${assignmentData.totalPoints}" 
                                                value="${submission.grade || ''}">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="feedback-${submission.studentId}">Feedback</label>
                                            <textarea id="feedback-${submission.studentId}" class="form-control" 
                                                    rows="3">${submission.feedback || ''}</textarea>
                                        </div>
                                        
                                        <button class="btn btn-primary save-grade-btn" 
                                                data-student-id="${submission.studentId}" 
                                                data-assignment-id="${assignmentData.id}">
                                            Save Grade
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary close-btn">Close</button>
                    </div>
                </div>
            </div>
        `;
        
        // Insert the modal HTML into the page
        const modalContainer = document.createElement('div');
        modalContainer.innerHTML = modalHTML;
        document.body.appendChild(modalContainer.firstElementChild);
        
        // Get the modal element
        const modal = document.getElementById('grade-modal');
        
        // Add event listeners for closing the modal
        const closeButtons = modal.querySelectorAll('.close, .close-btn');
        closeButtons.forEach(button => {
            button.addEventListener('click', function() {
                modal.remove();
            });
        });
        
        // Add event listeners for save grade buttons
        const saveButtons = modal.querySelectorAll('.save-grade-btn');
        saveButtons.forEach(button => {
            button.addEventListener('click', function() {
                const studentId = this.getAttribute('data-student-id');
                const assignmentId = this.getAttribute('data-assignment-id');
                const gradeInput = document.getElementById(`grade-${studentId}`);
                const feedbackInput = document.getElementById(`feedback-${studentId}`);
                
                // Ensure inputs exist
                if (!gradeInput || !feedbackInput) {
                    console.error('Grade or feedback input not found');
                    return;
                }
                
                const grade = gradeInput.value;
                const feedback = feedbackInput.value;
                
                // Save the grade (in a real app, you would call your API)
                console.log('Saving grade:', {
                    assignmentId,
                    studentId,
                    grade,
                    feedback
                });
                
                // Show success message
                const studentName = assignmentData.submissions.find(s => s.studentId === studentId)?.studentName || 'Student';
                alert(`Grade saved successfully for ${studentName}`);
                
                // Disable button temporarily
                this.disabled = true;
                this.textContent = 'Saved!';
                
                setTimeout(() => {
                    this.disabled = false;
                    this.textContent = 'Save Grade';
                }, 2000);
            });
        });
        
        // Close modal when clicking outside
        modal.addEventListener('click', function(event) {
            if (event.target === this) {
                this.remove();
            }
        });
    } catch (error) {
        console.error('Error showing grade modal:', error);
        alert('An error occurred while trying to show the grading modal. Please try again.');
    }
}

// Show edit modal
function showEditModal(assignmentId) {
    try {
        console.log('Creating edit modal for assignment:', assignmentId);
        
        // Clear any existing modals
        clearExistingModals();
        
        // Demo data - in a real app, you would fetch this from your API
        const assignmentData = {
            id: assignmentId,
            title: 'Assignment ' + assignmentId,
            description: 'This is the assignment description. Students should complete the tasks as specified.',
            dueDate: new Date(Date.now() + 7 * 86400000).toISOString(), // One week from now
            totalPoints: 100,
            course: 'course1'
        };
        
        // Format date for input (YYYY-MM-DD)
        const dueDate = new Date(assignmentData.dueDate);
        const formattedDate = dueDate.toISOString().split('T')[0];
        
        // Create modal HTML
        const modalHTML = `
            <div id="edit-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Edit Assignment</h2>
                        <span class="close">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="edit-form">
                            <div class="form-group">
                                <label for="title">Title</label>
                                <input type="text" id="title" class="form-control" value="${assignmentData.title}" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="description">Description</label>
                                <textarea id="description" class="form-control" rows="4" required>${assignmentData.description}</textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group half-width">
                                    <label for="due-date">Due Date</label>
                                    <input type="date" id="due-date" class="form-control" value="${formattedDate}" required>
                                </div>
                                
                                <div class="form-group half-width">
                                    <label for="total-points">Total Points</label>
                                    <input type="number" id="total-points" class="form-control" 
                                        min="1" max="100" value="${assignmentData.totalPoints}" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="course">Class</label>
                                <select id="course" class="form-control" required>
                                    <option value="course1" ${assignmentData.course === 'course1' ? 'selected' : ''}>Conversational English</option>
                                    <option value="course2" ${assignmentData.course === 'course2' ? 'selected' : ''}>Business English</option>
                                    <option value="course3" ${assignmentData.course === 'course3' ? 'selected' : ''}>Beginner English</option>
                                    <option value="course4" ${assignmentData.course === 'course4' ? 'selected' : ''}>IELTS Preparation</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary close-btn">Cancel</button>
                        <button class="btn btn-primary save-btn" data-id="${assignmentData.id}">Save Changes</button>
                    </div>
                </div>
            </div>
        `;
        
        // Insert the modal HTML into the page
        const modalContainer = document.createElement('div');
        modalContainer.innerHTML = modalHTML;
        document.body.appendChild(modalContainer.firstElementChild);
        
        // Get the modal element
        const modal = document.getElementById('edit-modal');
        
        // Add event listeners for closing the modal
        const closeButtons = modal.querySelectorAll('.close, .close-btn');
        closeButtons.forEach(button => {
            button.addEventListener('click', function() {
                modal.remove();
            });
        });
        
        // Add event listener for save button
        const saveButton = modal.querySelector('.save-btn');
        if (saveButton) {
            saveButton.addEventListener('click', function() {
                const titleInput = document.getElementById('title');
                const descriptionInput = document.getElementById('description');
                const dueDateInput = document.getElementById('due-date');
                const totalPointsInput = document.getElementById('total-points');
                const courseInput = document.getElementById('course');
                
                // Ensure all inputs exist
                if (!titleInput || !descriptionInput || !dueDateInput || !totalPointsInput || !courseInput) {
                    console.error('One or more form inputs not found');
                    return;
                }
                
                const title = titleInput.value;
                const description = descriptionInput.value;
                const dueDate = dueDateInput.value;
                const totalPoints = totalPointsInput.value;
                const course = courseInput.value;
                
                // Validate form
                if (!title || !description || !dueDate || !totalPoints || !course) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // Save the changes (in a real app, you would call your API)
                console.log('Saving assignment changes:', {
                    id: assignmentId,
                    title,
                    description,
                    dueDate,
                    totalPoints,
                    course
                });
                
                // Show success message and close modal
                alert('Assignment updated successfully!');
                modal.remove();
                
                // Update the assignment title in the UI
                const assignmentElements = document.querySelectorAll(`[data-id="${assignmentId}"]`);
                assignmentElements.forEach(el => {
                    const parent = el.closest('tr, .assignment-item, div');
                    if (parent) {
                        const titleEl = parent.querySelector('.assignment-title');
                        if (titleEl) {
                            titleEl.textContent = title;
                        }
                    }
                });
            });
        }
        
        // Close modal when clicking outside
        modal.addEventListener('click', function(event) {
            if (event.target === this) {
                this.remove();
            }
        });
    } catch (error) {
        console.error('Error showing edit modal:', error);
        alert('An error occurred while trying to show the edit modal. Please try again.');
    }
}

// Handle delete assignment
function handleDeleteAssignment(assignmentId) {
    try {
        console.log('Deleting assignment:', assignmentId);
        
        // Delete the assignment (in a real app, you would call your API)
        
        // Show success message
        alert('Assignment deleted successfully!');
        
        // Remove the assignment from the UI
        const assignmentButtons = document.querySelectorAll(`button[data-id="${assignmentId}"]`);
        assignmentButtons.forEach(button => {
            const parent = button.closest('tr, .assignment-item, div');
            if (parent) {
                parent.remove();
            }
        });
    } catch (error) {
        console.error('Error deleting assignment:', error);
        alert('An error occurred while trying to delete the assignment. Please try again.');
    }
}
    </script>
</body>
</html>